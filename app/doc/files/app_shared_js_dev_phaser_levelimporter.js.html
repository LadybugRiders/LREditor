<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>app\shared\js\dev\phaser\levelimporter.js - LREditor API</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="LREditor API"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Behaviour.Button.html">Behaviour.Button</a></li>
                                <li><a href="../classes/Behaviour.LR.Editor.Behaviour.ScrollerVertical.html">Behaviour.LR.Editor.Behaviour.ScrollerVertical</a></li>
                                <li><a href="../classes/Behaviour.ScrollerHorizontal.html">Behaviour.ScrollerHorizontal</a></li>
                                <li><a href="../classes/Behaviour.Trigger.html">Behaviour.Trigger</a></li>
                                <li><a href="../classes/Behaviour.TriggerChangeLevel.html">Behaviour.TriggerChangeLevel</a></li>
                                <li><a href="../classes/Behaviour.TriggerCutscene.html">Behaviour.TriggerCutscene</a></li>
                                <li><a href="../classes/Editor.AssetManager.html">Editor.AssetManager</a></li>
                                <li><a href="../classes/Editor.LevelImporterEditor.html">Editor.LevelImporterEditor</a></li>
                                <li><a href="../classes/Entity.BitmapText.html">Entity.BitmapText</a></li>
                                <li><a href="../classes/Entity.Button.html">Entity.Button</a></li>
                                <li><a href="../classes/Entity.Sprite.html">Entity.Sprite</a></li>
                                <li><a href="../classes/Entity.Text.html">Entity.Text</a></li>
                                <li><a href="../classes/Entity.TileSprite.html">Entity.TileSprite</a></li>
                                <li><a href="../classes/LR.Behaviour.html">LR.Behaviour</a></li>
                                <li><a href="../classes/LR.Body.html">LR.Body</a></li>
                                <li><a href="../classes/LR.CollisionManager.html">LR.CollisionManager</a></li>
                                <li><a href="../classes/LR.Game.html">LR.Game</a></li>
                                <li><a href="../classes/LR.GameObject.html">LR.GameObject</a></li>
                                <li><a href="../classes/LR.LevelExporter.html">LR.LevelExporter</a></li>
                                <li><a href="../classes/LR.LevelImporter.html">LR.LevelImporter</a></li>
                                <li><a href="../classes/LR.LevelImporterGame.html">LR.LevelImporterGame</a></li>
                                <li><a href="../classes/LR.LevelUtilities.html">LR.LevelUtilities</a></li>
                                <li><a href="../classes/LR.LR.html">LR.LR</a></li>
                                <li><a href="../classes/LR.State.html">LR.State</a></li>
                                <li><a href="../classes/LR.Utils.html">LR.Utils</a></li>
                                <li><a href="../classes/Misc.TriggerMessageObject.html">Misc.TriggerMessageObject</a></li>
                                <li><a href="../classes/Phaser.Plugin..Pollinator.html">Phaser.Plugin..Pollinator</a></li>
                                <li><a href="../classes/Phaser.Plugin.CutsceneManager.html">Phaser.Plugin.CutsceneManager</a></li>
                                <li><a href="../classes/Phaser.Plugin.DialogManager.html">Phaser.Plugin.DialogManager</a></li>
                                <li><a href="../classes/Phaser.Plugin.InputManager.html">Phaser.Plugin.InputManager</a></li>
                                <li><a href="../classes/Phaser.Plugin.PlayerSave.html">Phaser.Plugin.PlayerSave</a></li>
                                <li><a href="../classes/UI.DialogBox.html">UI.DialogBox</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: app\shared\js\dev\phaser\levelimporter.js</h1>
                        
                        <div class="file">
                            <pre class="code prettyprint linenums">
                        &quot;use strict&quot;;
                        
                        /**
                        * Import a level.
                        *
                        * @namespace LR
                        * @class LevelImporter
                        * @constructor
                        */
                        LR.LevelImporter = function() {
                        
                        };
                        
                        /**
                        * Import all the level.
                        *
                        * @method import
                        * @param {Object} level The level to import
                        * @param {Phaser.Game} game The game where the level will be imported
                        * @param {function} promise A promise
                        */
                        LR.LevelImporter.prototype.import = function(_level, _game, _promise) {
                        	var loader = new Phaser.Loader(_game);
                        	this.importAssets(_level.assets, loader, _game);
                        	// if assets need to be loaded
                        	if (loader.totalQueuedFiles() &gt; 0) {
                        		loader.start();
                        		loader.onLoadComplete.add(function() {
                        			// now assets are loaded, we can import entities
                        			this.importEntitiesAndDo(_level.objects, _game, _promise);
                        		}, this);	
                        	} else {
                        		// directly create object
                        		this.importEntitiesAndDo(_level.objects, _game, _promise);
                        	}
                        };
                        
                        /***********
                        ** ASSETS **
                        ***********/
                        
                        /**
                        * Import all the assets (images, sounds, etc...)
                        *
                        * @method importAssets
                        * @param {Object} assets Assets informations
                        * @param {Phaser.Loader} loader The loader used to import assets
                        */
                        LR.LevelImporter.prototype.importAssets = function(_assets, _loader) {
                        	if (_assets)
                        	{
                        		if (_assets.images) {
                        			this.importImages(_assets.images, _loader);
                        		}
                        
                        		if (_assets.atlases) {
                        			this.importAtlases(_assets.atlases, _loader);
                        		}
                        	}
                        	
                        };
                        
                        /***********
                        ** IMAGES **
                        ***********/
                        
                        /**
                        * Import all the images
                        *
                        * @method importImages
                        * @param {Object} images Images informations
                        * @param {Phaser.Loader} loader The loader used to import images
                        */
                        LR.LevelImporter.prototype.importImages = function(_images, _loader) {
                        	for (var i = 0; i &lt; _images.length; i++) {
                        		var img = _images[i];
                        		_loader.spritesheet(
                        			img.name, img.path, img.frameWidth, img.frameHeight);
                        	};
                        };
                        
                        LR.LevelImporter.prototype.importAtlases = function(_atlases, _loader) {
                        	if(_atlases == null)
                        		return;
                        	var atlasesPath = this.$scope.project.path+&quot;/assets/atlases&quot;;
                        	for (var i = 0; i &lt; _atlases.length; i++) {
                        		var atlas = _atlases[i];
                        		_loader.atlas(
                        			atlas.name, atlasesPath+atlas.path + &quot;.png&quot;, 
                        			atlasesPath+atlas.path+&quot;.json&quot;);
                        	};
                        };
                        
                        /************
                        ** ENTITIES **
                        ************/
                        
                        /**
                        * Import all entities and do the promise
                        *
                        * @method importEntitiesAndDo
                        * @param {Object} objects Entities informations
                        * @param {Phaser.Game} game The game where entities will be imported
                        * @param {function} promise A promise
                        * @return the root of all entities
                        */
                        LR.LevelImporter.prototype.importEntitiesAndDo = function(_objects, _game, _promise) {
                        	var error = null;
                        	var root = null;
                        
                        	if (_objects) {
                        		root = this.importEntities(_objects, _game);
                        		this.doAfterImportEntitiesAndBeforePromise(_objects, _game);
                        	} else {
                        		error = &quot;No entity to import.&quot;;
                        	}
                        	
                        	if (typeof _promise === &quot;function&quot;) {
                        		_promise(error, root, _game);
                        	}
                        };
                        
                        /**
                        * Import all entities
                        *
                        * @method importEntities
                        * @param {Object} Objects Entities informations
                        * @param {Phaser.Game} game The game where entities will be imported
                        */
                        LR.LevelImporter.prototype.importEntities = function(_object, _game) {
                        	var entity = null;
                        	if (_object.name === &quot;__world&quot;) {
                        		// do nothing (already created by Phaser)
                        		entity = _game.world;
                        		entity.setBounds(0, 0, _object.width, _object.height);
                        	} else {
                        		entity = this.importEntity(_object, _game);
                        		entity.updateTransform();
                        	}
                        
                        	if (_object.children != null) {
                        		for (var i = 0; i &lt; _object.children.length; i++) {
                        			var child = _object.children[i];
                        			var cChild = this.importEntities(child, _game);
                        			if( entity == null ){
                        				console.log(&quot;Parent is null&quot;);
                        			}else if (cChild) {			
                        				if(child.type == &quot;LR.Entity.Group&quot; &amp;&amp; cChild.onAddedToGroup)
                        					cChild.onAddedToGroup(cChild ,entity);
                        				entity.add(cChild,true);
                        				cChild.updateTransform();
                        			}
                        		};
                        	}
                        
                        	return entity;
                        }
                        
                        /**
                        * Override this method to do something between the entities importation and
                        * the promise
                        *
                        * @method doAfterImportEntitiesAndBeforePromise
                        * @param {Object} objects Entities informations
                        * @param {Phaser.Game} game The game where entiites will be imported
                        */
                        LR.LevelImporter.prototype.doAfterImportEntitiesAndBeforePromise = function(_object, _game) {
                        
                        };
                        
                        /**
                        * Import an entity
                        *
                        * @method importEntity
                        * @param {Object} object Entity informations
                        * @param {Phaser.Game} game The game where entities will be imported
                        */
                        LR.LevelImporter.prototype.importEntity = function(_object, _game) {
                        	var entity = LR.LevelUtilities.CreateEntityByType(_object, _game);
                        
                        	if (entity) {
                        
                        		this.setGeneral(_object, entity);
                        
                        		this.setDisplay(_object, entity);
                        
                        		if (_object.body) {
                        			this.setPhysics(_object, entity);
                        		}
                        
                        		this.setBehaviours(_object, entity);
                        
                        		this.setTweens(_object, entity);
                        
                        		this.setSounds(_object, entity);
                        	}
                        
                        	//ANCHOR
                        	if( _object.anchor ){
                        		entity.anchor.setTo(_object.anchor.x , _object.anchor.y);
                        	} 
                        
                        	return entity;
                        };
                        
                        LR.LevelImporter.prototype.setGeneral = function(_objectData, _entity) {
                        	_entity.name = _objectData.name;
                        	_entity.go.name = _objectData.name;
                        	_entity.x = _objectData.x;
                        	_entity.y = _objectData.y;
                        	_entity.angle = _objectData.angle;
                        
                        	/*if( _objectData.anchor ){
                        		console.log(_objectData.anchor);
                        		_entity.anchor.setTo(_objectData.anchor.x , _objectData.anchor.y);
                        		console.log(_entity.anchor);
                        	} */
                        	
                        	if( _objectData.scaleX &amp;&amp; _objectData.scaleY){
                        		_entity.scale.x = _objectData.scaleX;
                        		_entity.scale.y = _objectData.scaleY;
                        	}
                        
                        	if(		_objectData.type == &quot;LR.Entity.Sprite&quot;
                        		||	_objectData.type == &quot;LR.Entity.TileSprite&quot;
                        		||	_objectData.type == &quot;LR.Entity.Button&quot;
                        	) {
                        		_entity.width = _objectData.width;
                        		_entity.height = _objectData.height;
                        	}  
                        	//TEXT
                        	if(_objectData.type == &quot;LR.Entity.Text&quot;){
                        		if (_objectData.textData) {
                        			_entity.text = _objectData.textData.text;
                        			//Reset width after font settings are filled
                        			_entity.updateTransform();
                        		}
                        	}
                        	//BITMAP TEXT
                        	if( _objectData.type == &quot;LR.Entity.BitmapText&quot;){
                        		if (_objectData.textData) {
                        			if(_objectData.textData.fontSize)
                        				_entity.fontSize = _objectData.textData.fontSize;
                        			if(_objectData.textData.font)
                        				_entity.font = _objectData.textData.font;
                        			if(_objectData.textData.maxChar)
                        				_entity.maxCharPerLine = _objectData.textData.maxChar;
                        			_entity.text = _objectData.textData.text;	
                        			_entity.setStyle();	
                        		}
                        	}
                        };
                        
                        LR.LevelImporter.prototype.setDisplay = function(_objectData, _entity) {
                        	_entity.visible = _objectData.visible;
                        	_entity.alpha = _objectData.alpha || 1;
                        
                        	if (_objectData.key) {
                        		var w = _entity.width;
                        		var h = _entity.height;
                        		_entity.loadTexture(_objectData.key, _objectData.frame);
                        		_entity.width = w;
                        		_entity.height = h;
                        		if( _objectData.type == &quot;LR.Entity.TileSprite&quot; &amp;&amp; _entity.game.renderType == Phaser.CANVAS){
                        			_entity.tilePosition.y = h ;//* 0.5;
                        			_entity.tilePosition.x = w ;//* 0.5;
                        		}
                        	}
                        
                        	if( _objectData.frameName ){
                        		_entity.isAtlas = true;
                        		_entity.frameName = _objectData.frameName;
                        	}
                        
                        	if(_objectData.type == &quot;LR.Entity.Button&quot;){
                        		_entity.setFrames(
                        			_objectData.onOverFrameID,
                        			_objectData.onOutFrameID,
                        			_objectData.onDownFrameID,
                        			_objectData.onUpFrameID
                        		);
                        	}
                        
                        	//tint color
                        	if( _objectData.tint != null ){
                        		if( typeof(_objectData.tint) == &quot;string&quot;){
                        			_entity.tint = parseInt(_objectData.tint);
                        		}else{
                        			_entity.tint = _objectData.tint;
                        		}
                        	}
                        
                        	//Animations
                        	if( _objectData.anims){
                        		for( var key in _objectData.anims){
                        			var newAnim = _entity.animations.add(
                        				key,
                        				_objectData.anims[key].frames,
                        				_objectData.anims[key].speed,
                        				_objectData.anims[key].loop
                        			);
                        			if( _objectData.anims[key].timer != null )
                        				newAnim.timer = _objectData.anims[key].timer ;
                        		}
                        	}
                        };
                        
                        /*
                        * Adds a body to the entity with the data provided by objectData and creates all shapes
                        */
                        LR.LevelImporter.prototype.setPhysics = function(_objectData, _entity) {
                        	_entity.go.layer = _objectData.layer;
                        
                        	var motionState = Phaser.Physics.P2.Body.DYNAMIC;
                        	if (_objectData.body.motion === &quot;STATIC&quot;){
                        		motionState = Phaser.Physics.P2.Body.STATIC;
                        	} else if( _objectData.body.motion === &quot;KINEMATIC&quot;){
                        		motionState = Phaser.Physics.P2.Body.KINEMATIC;
                        	}
                        
                        	//P2 crash when adding a body onto a sprite with scales &lt; 0
                        	//so we need a workaround. we&#x27;ll temporarily change its scale beforce adding the body
                        	var scale = { x : _entity.scale.x, y : _entity.scale.y};
                        	if( scale.x &lt; 0 ) _entity.scale.x *= -1;
                        	if( scale.y &lt; 0 ) _entity.scale.y *= -1;
                        
                        	_entity.go.enablePhysics(motionState);
                        
                        	//Rescale after sprite workaround
                        	_entity.scale.x = scale.x; _entity.scale.y = scale.y;
                        
                        	//adding a body has prevented us from setting the position directly to the sprite
                        	_entity.body.x = _objectData.x;
                        	_entity.body.y = _objectData.y;
                        
                        	_entity.body.fixedRotation = _objectData.body.fixedRotation;
                        	_entity.body.angle = _objectData.body.angle;
                        	_entity.body.data.gravityScale = _objectData.body.gravity;
                        	_entity.body.data.mass = _objectData.body.mass;
                        
                        	_entity.body.bindRotation = _objectData.body.bindRotation || false;
                        	if( _entity.body.bindRotation ){
                        		_entity.body._offsetRotation = _objectData.body.offsetRotation;
                        	}
                        	// go through the shapes data and create real shapes
                        	for( var i=0; i &lt; _objectData.body.shapes.length ; i++){
                        		var shapeData = _objectData.body.shapes[i];
                        		//this will replace a shape or replace the current one
                        		var newShape = null;
                        		if(shapeData.type == &quot;rectangle&quot; || shapeData.type == null){
                        			newShape = _entity.go.replaceShapeByRectangle(i, shapeData);	
                        		}else if(shapeData.type == &quot;circle&quot;){
                        			newShape = _entity.go.replaceShapeByCircle(i, shapeData);	
                        		} 	
                        		newShape.sensor = shapeData.sensor;
                        		newShape.lr_name = shapeData.name;
                        	}
                        };
                        
                        LR.LevelImporter.prototype.setBehaviours = function(_objectData, _entity) {
                        	_entity.behaviours = JSON.parse( JSON.stringify(_objectData.behaviours) );
                        };
                        
                        LR.LevelImporter.prototype.setTweens = function(_objectData, _entity) {};
                        
                        LR.LevelImporter.prototype.setSounds = function(_objectData, _entity) {};
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
