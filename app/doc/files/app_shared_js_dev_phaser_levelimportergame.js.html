<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>app\shared\js\dev\phaser\levelimportergame.js - LREditor API</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="LREditor API"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Behaviour.Button.html">Behaviour.Button</a></li>
                                <li><a href="../classes/Behaviour.LR.Editor.Behaviour.ScrollerVertical.html">Behaviour.LR.Editor.Behaviour.ScrollerVertical</a></li>
                                <li><a href="../classes/Behaviour.ScrollerHorizontal.html">Behaviour.ScrollerHorizontal</a></li>
                                <li><a href="../classes/Behaviour.Trigger.html">Behaviour.Trigger</a></li>
                                <li><a href="../classes/Behaviour.TriggerChangeLevel.html">Behaviour.TriggerChangeLevel</a></li>
                                <li><a href="../classes/Behaviour.TriggerCutscene.html">Behaviour.TriggerCutscene</a></li>
                                <li><a href="../classes/Editor.LevelImporterEditor.html">Editor.LevelImporterEditor</a></li>
                                <li><a href="../classes/Entity.BitmapText.html">Entity.BitmapText</a></li>
                                <li><a href="../classes/Entity.Button.html">Entity.Button</a></li>
                                <li><a href="../classes/Entity.Sprite.html">Entity.Sprite</a></li>
                                <li><a href="../classes/Entity.Text.html">Entity.Text</a></li>
                                <li><a href="../classes/Entity.TileSprite.html">Entity.TileSprite</a></li>
                                <li><a href="../classes/LR.Behaviour.html">LR.Behaviour</a></li>
                                <li><a href="../classes/LR.Body.html">LR.Body</a></li>
                                <li><a href="../classes/LR.CollisionManager.html">LR.CollisionManager</a></li>
                                <li><a href="../classes/LR.Game.html">LR.Game</a></li>
                                <li><a href="../classes/LR.GameObject.html">LR.GameObject</a></li>
                                <li><a href="../classes/LR.LevelExporter.html">LR.LevelExporter</a></li>
                                <li><a href="../classes/LR.LevelImporter.html">LR.LevelImporter</a></li>
                                <li><a href="../classes/LR.LevelImporterGame.html">LR.LevelImporterGame</a></li>
                                <li><a href="../classes/LR.LevelUtilities.html">LR.LevelUtilities</a></li>
                                <li><a href="../classes/LR.LR.html">LR.LR</a></li>
                                <li><a href="../classes/LR.State.html">LR.State</a></li>
                                <li><a href="../classes/Misc.TriggerMessageObject.html">Misc.TriggerMessageObject</a></li>
                                <li><a href="../classes/Phaser.Plugin..Pollinator.html">Phaser.Plugin..Pollinator</a></li>
                                <li><a href="../classes/Phaser.Plugin.CutsceneManager.html">Phaser.Plugin.CutsceneManager</a></li>
                                <li><a href="../classes/Phaser.Plugin.DialogManager.html">Phaser.Plugin.DialogManager</a></li>
                                <li><a href="../classes/Phaser.Plugin.InputManager.html">Phaser.Plugin.InputManager</a></li>
                                <li><a href="../classes/Phaser.Plugin.PlayerSave.html">Phaser.Plugin.PlayerSave</a></li>
                                <li><a href="../classes/UI.DialogBox.html">UI.DialogBox</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: app\shared\js\dev\phaser\levelimportergame.js</h1>
                        
                        <div class="file">
                            <pre class="code prettyprint linenums">
                        &quot;use strict&quot;;
                        
                        /**
                        * Import a level for a game.
                        *
                        * @namespace LR
                        * @class LevelImporterGame
                        * @constructor
                        */
                        LR.LevelImporterGame = function() {
                        	LR.LevelImporter.call(this);
                        };
                        
                        LR.LevelImporterGame.prototype = Object.create(LR.LevelImporter.prototype);
                        LR.LevelImporterGame.prototype.constructor = LR.LevelImporterGame;
                        
                        LR.LevelImporterGame.prototype.import = function(_level, _game, _promise) {
                        	this.debugBodiesInGame = _level.settings.debugBodiesInGame;
                        
                        	LR.LevelImporter.prototype.import.call(this,_level,_game,_promise);
                        	
                        	if (_game.cutsceneManager) {
                        		_game.cutsceneManager.loadCutscenes( _level.cutscenes );
                        	}
                        
                        	//Place Camera
                        	if (_level.settings) {
                        		_game.camera.bounds = null;
                        		_game.camera.x = _level.settings.camera.x;
                        		_game.camera.y = _level.settings.camera.y;
                        	}
                        };
                        
                        LR.LevelImporterGame.prototype.importAssets = function(_assets, _loader) {
                        	LR.LevelImporter.prototype.importAssets.call(this, _assets, _loader);
                        
                        	this.importSounds(_assets.sounds, _loader);
                        	this.importBehaviours(_assets.behaviours, _loader);
                        	this.importBitmapFonts(_assets.bitmapFonts,_loader);
                        };
                        
                        /**
                        * Import all the images
                        *
                        * @method importImages
                        * @param {Object} images Images informations
                        * @param {Phaser.Loader} loader The loader used to import images
                        */
                        LR.LevelImporterGame.prototype.importImages = function(_images, _loader) {
                        	for (var i = 0; i &lt; _images.length; i++) {
                        		var img = _images[i];
                        
                        		var imgPath = &quot;assets/images&quot; + img.path;
                        
                        		_loader.spritesheet(
                        			img.name, imgPath,
                        			parseInt(img.frameWidth), parseInt(img.frameHeight)
                        		);
                        	};
                        };
                        
                        LR.LevelImporterGame.prototype.importAtlases = function(_atlases, _loader) {
                        	if(_atlases == null)
                        		return;
                        	var atlasesPath = &quot;assets/atlases&quot;;
                        	for (var i = 0; i &lt; _atlases.length; i++) {
                        		var atlas = _atlases[i];
                        		_loader.atlas(
                        			atlas.name, atlasesPath+atlas.path + &quot;.png&quot;, 
                        			atlasesPath+atlas.path+&quot;.json&quot;);
                        	};
                        };
                        
                        LR.LevelImporterGame.prototype.importSounds = function(_sounds, _loader) {
                        	if(_sounds == null)
                        		return;
                        	for(var i=0; i &lt; _sounds.length; i ++){
                        		_loader.audio( _sounds[i].name,&quot;assets/audios&quot; + _sounds[i].path);
                        	}
                        }
                        
                        
                        LR.LevelImporterGame.prototype.importBitmapFonts = function(_bitmapFonts, _loader) {
                        	if( _bitmapFonts == null)
                        		return;
                        	for(var i=0; i &lt; _bitmapFonts.length; i ++){
                        		var path_data = &quot;assets/fonts&quot; + _bitmapFonts[i].pathData; 
                        
                        		if( _loader.game.device.cocoonJS == true &amp;&amp; _bitmapFonts[i].pathJson != null)
                        			path_data = &quot;assets/fonts&quot; + _bitmapFonts[i].pathJson;
                        
                        		_loader.bitmapFont( _bitmapFonts[i].name,
                        							&quot;assets/fonts&quot; + _bitmapFonts[i].path, 
                        							path_data);
                        	}
                        }
                        
                        /**
                        * Import all the behaviours
                        *
                        * @method importBehaviours
                        * @param {Object} behaviours Behaviours informations
                        * @param {Phaser.Loader} loader The loader used to import behaviours
                        */
                        LR.LevelImporterGame.prototype.importBehaviours = function(_behaviours, _loader) {
                        	for (var i = 0; i &lt; _behaviours.length; i++) {
                        		var behaviour = _behaviours[i];
                        		_loader.script(behaviour.name, &quot;assets/behaviours&quot; + behaviour.path);
                        	};
                        };
                        
                        LR.LevelImporterGame.prototype.doAfterImportEntitiesAndBeforePromise = function(_objects, _game) {
                        	LR.LevelImporter.prototype.doAfterImportEntitiesAndBeforePromise.call(this, _objects, _game);
                        	this.callBehavioursCreate(_game);
                        };
                        
                        LR.LevelImporterGame.prototype.importEntity = function(_object, _game) {
                        	
                        	var entity = LR.LevelImporter.prototype.importEntity.call(this, _object, _game);
                        
                        	// Add GameObject to the state. Don&#x27;t add to game. Events are on.
                        	_game.state.getCurrentState().addGameObject(entity.go, false, true);
                        
                        	return entity;
                        };
                        
                        LR.LevelImporterGame.prototype.setGeneral = function(_objectData, _entity) {
                        	LR.LevelImporter.prototype.setGeneral.call(this, _objectData, _entity);
                        
                        	if(_objectData.fixedToCamera) {
                        		_entity.fixedToCamera = true;
                        	}
                        
                        };
                        
                        LR.LevelImporterGame.prototype.setDisplay = function(_objectData, _entity) {
                        	LR.LevelImporter.prototype.setDisplay.call(this, _objectData, _entity);
                        	//outofView
                        	if(_objectData.outOfViewHide == true)
                        		_entity.outOfViewHide = true;
                        	//auto scroll for tilesprites
                        	if (_objectData.type == &quot;LR.Entity.TileSprite&quot;) {
                        		if ( _objectData.scrollX != null)
                        			_entity._scroll.x = _objectData.scrollX;
                        
                        		if ( _objectData.scrollY != null)
                        			_entity._scroll.y = _objectData.scrollY;
                        	}
                        
                        	//animation timers
                        	if( _objectData.anims){
                        		for( var key in _objectData.anims){
                        			if( _objectData.anims[key].timer ){
                        				var anim = _entity.animations.getAnimation(key);
                        				anim.onComplete.add(
                        					function(_entity){
                        						_entity.game.time.events.add(
                        					      Phaser.Timer.SECOND * _objectData.anims[key].timer, 
                        					      anim.play,
                        					      anim);
                        					}
                        				);
                        			}
                        		}
                        	}
                        
                        	//animation autoplay
                        	if (_objectData.autoPlayAnim != null) {
                        		_entity.animations.play(_objectData.autoPlayAnim);
                        	}
                        };
                        
                        LR.LevelImporterGame.prototype.setPhysics = function(_objectData,_entity) {
                        	//Call base method
                        	LR.LevelImporter.prototype.setPhysics.call(this, _objectData, _entity);
                        	
                        	if( this.debugBodiesInGame &amp;&amp; _objectData.body.debug)
                        		_entity.body.debug = true;
                        }
                        
                        LR.LevelImporterGame.prototype.setBehaviours = function(_objectData, _entity) {
                        	if (_objectData.behaviours) {
                        		if (_objectData.behaviours.length &gt; 0) {
                        			for (var i = 0; i &lt; _objectData.behaviours.length; i++) {
                        				var bhData = _objectData.behaviours[i];
                        				if (bhData.name) {
                        					var behaviourClass = bhData.name;
                        
                        					var classes = behaviourClass.split(&quot;.&quot;);
                        
                        					var Class = null;
                        					
                        					for (var j = 0 ; j &lt; classes.length ; j++){
                        						var curClassName = classes[j];
                        						if (Class == null) {
                        							Class = (window || this)[curClassName];
                        						} else {
                        							Class = Class[curClassName];
                        						}
                        					}
                        
                        					if (Class) {
                        						var bhInstance = _entity.go.addBehaviour(new Class(_entity.go));
                        						//keep args for the create() of behaviours, done later
                        						bhInstance.args_create = bhData.params;
                        					} else {
                        						console.error(
                        							&quot;LR.LevelImporterGame - Unkown behaviour: &quot; + behaviourClass);
                        					}
                        				}
                        			};
                        		}
                        	}
                        };
                        
                        LR.LevelImporterGame.prototype.setTweens = function(_objectData, _entity) {
                        	if( _objectData.tweens != null ){
                        		var tweens = JSON.parse( JSON.stringify(_objectData.tweens)) ;
                        		for(var key in tweens){
                        			//Get tween and convert its properties
                            		_entity.go.addTween( tweens[key] );
                            	}
                        	}
                        };
                        
                        LR.LevelImporterGame.prototype.setSounds = function(_objectData, _entity) {
                        	if( _objectData.sounds != null ){
                        		for(var i=0; i &lt; _objectData.sounds.length; i++){
                        			var data = _objectData.sounds[i];
                        			var sound = _entity.game.add.audio(data.key);
                        			if( sound ){
                        				_entity.go.addSound(data.name,sound);
                        				if( data.autoPlay == true)
                        					_entity.go.playSound(data.name,1,data.loop);
                        			}
                        		}
                        	}
                        }
                        
                        LR.LevelImporterGame.prototype.callBehavioursCreate = function(_game) {
                        	// call behaviours create for every gameobjects
                        	var gameobjects = _game.state.getCurrentState().gameobjects;
                        
                        	for(var i=0; i &lt; gameobjects.length ; i ++){
                        		var go = gameobjects[i];
                        
                        		for(var j=0; j &lt; go.behaviours.length; j++ ){
                        			var bh = go.behaviours[j];
                        			bh = this.processBehaviourArgs(_game,bh);
                        			bh.create(bh.args_create);		
                        			bh.args_create = null;	
                        		}
                        	}
                        };
                        
                        // Check arguments value and find the gameobject if some are referenced
                        // From the editor, an arg value can have this form : #GO_XX where XX is a Number
                        // This references the gameobject with the id equal to XX
                        LR.LevelImporterGame.prototype.processBehaviourArgs = function(_game, _behaviour) {
                        	for(var key in _behaviour.args_create){
                        		var value = _behaviour.args_create[key];
                        		if( typeof value === &#x27;string&#x27;){
                        			if( value.indexOf(&quot;#GO_&quot;) == 0){
                        				value = value.substring(4);
                        				_behaviour.args_create[key] = LR.GameObject.FindByID(_game.world,parseInt(value));
                        			}
                        		}
                        	}
                        	return _behaviour;
                        };
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
