<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>app\editor\js\dev\phaser\levelimportereditor.js - LREditor API</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="LREditor API"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Behaviour.Button.html">Behaviour.Button</a></li>
                                <li><a href="../classes/Behaviour.LR.Editor.Behaviour.ScrollerVertical.html">Behaviour.LR.Editor.Behaviour.ScrollerVertical</a></li>
                                <li><a href="../classes/Behaviour.ScrollerHorizontal.html">Behaviour.ScrollerHorizontal</a></li>
                                <li><a href="../classes/Behaviour.Trigger.html">Behaviour.Trigger</a></li>
                                <li><a href="../classes/Behaviour.TriggerChangeLevel.html">Behaviour.TriggerChangeLevel</a></li>
                                <li><a href="../classes/Behaviour.TriggerCutscene.html">Behaviour.TriggerCutscene</a></li>
                                <li><a href="../classes/Editor.AssetManager.html">Editor.AssetManager</a></li>
                                <li><a href="../classes/Editor.LevelImporterEditor.html">Editor.LevelImporterEditor</a></li>
                                <li><a href="../classes/Entity.BitmapText.html">Entity.BitmapText</a></li>
                                <li><a href="../classes/Entity.Button.html">Entity.Button</a></li>
                                <li><a href="../classes/Entity.Sprite.html">Entity.Sprite</a></li>
                                <li><a href="../classes/Entity.Text.html">Entity.Text</a></li>
                                <li><a href="../classes/Entity.TileSprite.html">Entity.TileSprite</a></li>
                                <li><a href="../classes/LR.Behaviour.html">LR.Behaviour</a></li>
                                <li><a href="../classes/LR.Body.html">LR.Body</a></li>
                                <li><a href="../classes/LR.CollisionManager.html">LR.CollisionManager</a></li>
                                <li><a href="../classes/LR.Game.html">LR.Game</a></li>
                                <li><a href="../classes/LR.GameObject.html">LR.GameObject</a></li>
                                <li><a href="../classes/LR.LevelExporter.html">LR.LevelExporter</a></li>
                                <li><a href="../classes/LR.LevelImporter.html">LR.LevelImporter</a></li>
                                <li><a href="../classes/LR.LevelImporterGame.html">LR.LevelImporterGame</a></li>
                                <li><a href="../classes/LR.LevelUtilities.html">LR.LevelUtilities</a></li>
                                <li><a href="../classes/LR.LR.html">LR.LR</a></li>
                                <li><a href="../classes/LR.State.html">LR.State</a></li>
                                <li><a href="../classes/LR.Utils.html">LR.Utils</a></li>
                                <li><a href="../classes/Misc.TriggerMessageObject.html">Misc.TriggerMessageObject</a></li>
                                <li><a href="../classes/Phaser.Plugin..Pollinator.html">Phaser.Plugin..Pollinator</a></li>
                                <li><a href="../classes/Phaser.Plugin.CutsceneManager.html">Phaser.Plugin.CutsceneManager</a></li>
                                <li><a href="../classes/Phaser.Plugin.DialogManager.html">Phaser.Plugin.DialogManager</a></li>
                                <li><a href="../classes/Phaser.Plugin.InputManager.html">Phaser.Plugin.InputManager</a></li>
                                <li><a href="../classes/Phaser.Plugin.PlayerSave.html">Phaser.Plugin.PlayerSave</a></li>
                                <li><a href="../classes/UI.DialogBox.html">UI.DialogBox</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: app\editor\js\dev\phaser\levelimportereditor.js</h1>
                        
                        <div class="file">
                            <pre class="code prettyprint linenums">
                        &quot;use strict&quot;;
                        
                        /**
                        * Import a level in the editor
                        *
                        * @namespace Editor
                        * @class LevelImporterEditor
                        * @constructor
                        */
                        LR.Editor.LevelImporterEditor = function(_$scope) {
                        	LR.LevelImporter.call(this);
                        	this.$scope = _$scope;
                        };
                        
                        LR.Editor.LevelImporterEditor.prototype = Object.create(LR.LevelImporter.prototype);
                        LR.Editor.LevelImporterEditor.prototype.constructor = LR.Editor.LevelImporterEditor;
                        
                        LR.Editor.LevelImporterEditor.prototype.import = function(_level, _game, _promise) {
                        	
                        	if(_level.prefabName){
                        		this.prefab = { name : _level.prefabName, path : _level.prefabPath};
                        	}else{
                        		this.prefab = null;
                        	}
                        
                        	LR.LevelImporter.prototype.import.call(this,_level,_game,_promise);
                        
                        	this.$scope.cutscenes = _level.cutscenes;
                        	this.$scope.settings = _level.settings;
                        };
                        
                        /**
                        * Import all the images
                        *
                        * @method importImages
                        * @param {Object} images Images informations
                        * @param {Phaser.Loader} loader The loader used to import images
                        */
                        LR.Editor.LevelImporterEditor.prototype.importImages = function(_images, _loader) {
                        	for (var i = 0; i &lt; _images.length; i++) {
                        		var imgData = _images[i];
                        
                        		var imgPath = this.$scope.project.path + &quot;/assets/images&quot; + imgData.path;
                        
                        		_loader.spritesheet(
                        			imgData.name, imgPath,
                        			parseInt(imgData.frameWidth), parseInt(imgData.frameHeight)
                        		);
                        
                        		var projectImage = this.getProjectImageByName(imgData.name);
                        
                        		if (projectImage) {
                        			projectImage.frameWidth = imgData.frameWidth;
                        			projectImage.frameHeight = imgData.frameHeight;
                        			projectImage.loaded = true;
                        		} else {
                        			console.warn(&quot;image &#x27;&quot; + imgData.name + &quot;&#x27; loaded but not linked with the editor.&quot;);
                        		}
                        	};
                        };
                        
                        LR.Editor.LevelImporterEditor.prototype.getProjectImageByName = function(_name) {
                        	var projectImage = null;
                        
                        	var projectImages = this.$scope.project.assets.images;
                        
                        	var i = 0;
                        	var found = false;
                        	while (i&lt;projectImages.length &amp;&amp; found == false) {
                        		var img = projectImages[i];$
                        		
                        		if (img.name == _name) {
                        			projectImage = img;
                        			found = true;
                        		}
                        
                        		i++;
                        	}
                        
                        	return projectImage;
                        };
                        
                        //===================== ATLASES ========================
                        
                        LR.Editor.LevelImporterEditor.prototype.importAtlases = function(_atlases, _loader) {
                        	if(_atlases == null)
                        		return;
                        	for (var i = 0; i &lt; _atlases.length; i++) {
                        		var atData = _atlases[i];
                        		var atPath = this.$scope.project.path + &quot;/assets/atlases&quot; + atData.path;
                        
                        		_loader.atlasJSONHash(
                        			atData.name, atPath+&quot;.png&quot;, atPath+&quot;.json&quot;
                        		);
                        		_loader.json(atData.name, atPath+&quot;.json&quot;);
                        
                        		var projectImage = this.getProjectAtlasByName(atData.name);
                        		if (projectImage) {
                        			projectImage.loaded = true;
                        		} else {
                        			console.warn(&quot;image &#x27;&quot; + atData.name + &quot;&#x27; loaded but not linked with the editor.&quot;);
                        		}
                        	}
                        	//Create a function that will fill the frames data of each atlas
                        	//at the end of the loading
                        	_loader.onLoadComplete.add(this.getAtlasesFrames,this);
                        };
                        
                        LR.Editor.LevelImporterEditor.prototype.getProjectAtlasByName = function(_name) {
                        	var projectAtlas = null;
                        
                        	var projectAtlases = this.$scope.project.assets.atlases;
                        
                        	var i = 0;
                        	var found = false;
                        	while (i&lt;projectAtlases.length &amp;&amp; found == false) {
                        		var img = projectAtlases[i];
                        		if (img.name == _name) {
                        			projectAtlas = img;
                        			found = true;
                        		}
                        
                        		i++;
                        	}
                        
                        	return projectAtlas;
                        };
                        
                        LR.Editor.LevelImporterEditor.prototype.getAtlasesFrames = function() {
                        	var atlases = this.$scope.project.assets.atlases;
                        	for(var i=0; i &lt; atlases.length; i++){
                        		if( atlases[i].loaded){
                        			atlases[i].frames = this.$scope.game.cache.getJSON(atlases[i].name).frames;
                        		}
                        	}
                        
                        	this.$scope.game.load.onLoadComplete.remove(this.getAtlasesFrames);
                        };
                        
                        //======================================================
                        
                        LR.Editor.LevelImporterEditor.prototype.importEntity = function(_object, _game) {
                        	var entity = LR.LevelImporter.prototype.importEntity.call(this, _object, _game);
                        	//we want to know which is the higher ID. this is the perfect place
                        	if( this.$scope.ID_count &lt; entity.go.id ){
                        		this.$scope.ID_count = entity.go.id;
                        	}
                        	//if this.prefab exists, we are currently importing a prefab
                        	if( this.prefab ){
                        		entity.prefab = this.prefab;
                        		this.prefab = null;
                        	//else if the imported object contains a prefab property
                        	}else if(_object.prefab){
                        		entity.prefab = _object.prefab;
                        	}
                        	return entity;
                        };
                        
                        LR.Editor.LevelImporterEditor.prototype.setDisplay = function(_objectData, _entity){
                        	LR.LevelImporter.prototype.setDisplay.call(this, _objectData, _entity);
                        	//Out Of View Hide
                        	_entity.outOfViewHide = false; //Deactivate this to prevent sprite from disapearing in the editor
                        	if( _objectData.outOfViewHide == true ){
                        		_entity.ed_outOfViewHide = true;
                        	}
                        	//set key to none if null
                        	if(_objectData.key == null &amp;&amp; 
                        		( _objectData.type == LR.LevelUtilities.TYPE_SPRITE ||_objectData.type == LR.LevelUtilities.TYPE_TILESPRITE)
                        		) {
                        		var w = _entity.width;
                        		var h = _entity.height;
                        		_entity.loadTexture(&quot;none&quot;, _objectData.frame);
                        		_entity.width = w;
                        		_entity.height = h;
                        	}
                        
                        	//Lock
                        	if (_objectData.locked) {
                        		_entity.ed_locked = true;
                        		this.$scope.lockEntity(_entity);
                        	} else {
                        		_entity.ed_locked = false;
                        	}
                        
                        	//Fixed to Camera
                        	if (_objectData.fixedToCamera == true) {
                        		_entity.ed_fixedToCamera = true;
                        		this.$scope.fixEntityToCamera(_entity, true);
                        	} else {
                        		_entity.ed_fixedToCamera = false;
                        	}
                        
                        	//autoscroll for tilesprites
                        	if(_objectData.type == &quot;LR.Entity.TileSprite&quot;){
                        		if( _objectData.scrollX != null)
                        			_entity.scrollX = _objectData.scrollX;
                        
                        		if( _objectData.scrollY != null)
                        			_entity.scrollY = _objectData.scrollY;
                        	}
                        
                        	// Button specifics
                        	if( _objectData.type == &quot;LR.Entity.Button&quot;) {
                        		// frames
                        		_entity.onOverFrameID = parseInt(_objectData.onOverFrameID | 0);
                        		_entity.onOutFrameID = parseInt(_objectData.onOutFrameID | 0);
                        		_entity.onDownFrameID = parseInt(_objectData.onDownFrameID | 0);
                        		_entity.onUpFrameID = parseInt(_objectData.onUpFrameID | 0);
                        	}
                        
                        	//tint color
                        	if( _objectData.tint != null &amp;&amp; typeof _objectData.tint == &#x27;string&#x27; ){	
                        		_entity.ed_tintColor = &quot;#&quot;+_objectData.tint.substring(2); 
                        	}
                        
                        	//animations
                        	if( _entity.animations &amp;&amp; _entity.animations._anims !== {}){
                        		var entityAnims = _entity.animations._anims;
                        		for( var key in entityAnims){
                        			//for edition, we need the array as a string
                        			entityAnims[key].ed_frames = JSON.stringify(entityAnims[key]._frames);
                        			entityAnims[key].loop = _objectData.anims[key].loop;
                        			entityAnims[key].speed = _objectData.anims[key].speed;
                        		}
                        		_entity.autoPlayAnim = _objectData.autoPlayAnim;
                        		_entity.autoPlayActive = (_entity.autoPlayAnim != null);
                        	}
                        };
                        
                        /*
                        * Adds a body to the entity with the data provided by objectData
                        */
                        LR.Editor.LevelImporterEditor.prototype.setPhysics = function(_objectData, _entity){
                        	//force dynamic ( we won&#x27;t be able to move the entity otherwise )
                        	//_entity.go.enablePhysics(Phaser.Physics.P2.Body.DYNAMIC);
                        	//Call base method
                        	LR.LevelImporter.prototype.setPhysics.call(this, _objectData, _entity);
                        
                        	_entity.go.motionState = Phaser.Physics.P2.Body.DYNAMIC;
                        	//Enable sensor ( we don&#x27;t want our entities to collide in the editor )
                        	_entity.go.enableSensor();
                        
                        	//EDITOR SPECIFIC STUFF
                        	_entity.body.ed_motion = _objectData.body.motion;
                        	_entity.body.ed_sensor = _objectData.body.sensor;
                        	_entity.body.ed_enabled = _objectData.body.enabled;
                        	//deactivate fixedrotation for editor
                        	_entity.body.ed_fixedRotation = _entity.body.fixedRotation;
                        	_entity.body.fixedRotation = false;
                        	//Debug Bodies
                        	_entity.body.ed_debugEditor = _objectData.body.debug;
                        	if( _objectData.body.debug == true ){
                        		_entity.body.debug = true;
                        		//move group of the debug body in the editor group ( preventing from exporting it )
                        		this.$scope.$emit(&quot;moveEntityToEditorEmit&quot;,{ entity : _entity.body.debugBody});
                        	}
                        
                        	for(var i=0; i &lt; _entity.go.getShapesCount(); i++){
                        		var shape = _entity.go.getShape(i);
                        		shape.ed_sensor = _objectData.body.shapes[i].sensor;
                        		shape.ed_type = LR.Utils.getShapeType(shape);
                        	}
                        };
                        
                        LR.Editor.LevelImporterEditor.prototype.setBehaviours = function(_objectData, _entity) {
                        	if(_objectData.behaviours != null ){
                        		for(var i=0; i &lt; _objectData.behaviours.length; i++){
                        			if(_objectData.behaviours[i].enabled == null)
                        				_objectData.behaviours[i].enabled = true;
                        		}
                        	}
                        	LR.LevelImporter.prototype.setBehaviours.call(this, _objectData, _entity);
                        	//add input behaviour on sprites /text
                        	if (_entity.type != Phaser.GROUP) {
                        		var inputHandleBH = _entity.go.addBehaviour(new LR.Editor.Behaviour.EntityInputHandler(_entity.go, this.$scope));
                        		if(_objectData.locked == true)
                        			inputHandleBH.lock();
                        	}
                        };
                        
                        LR.Editor.LevelImporterEditor.prototype.setTweens = function(_objectData, _entity) {
                        	if( _objectData.tweens != null ){
                        		var tweens = JSON.parse( JSON.stringify(_objectData.tweens)) ;
                        		for(var key in tweens){
                        			//easing cannot be null ( NONE is an obsolete value that should be discarded)
                        			if(tweens[key].easing == null || tweens[key].easing == &quot;NONE&quot;)
                        				tweens[key].easing = [&quot;Linear&quot;,&quot;None&quot;];
                        			_entity.go.tweensData[key] = {data:tweens[key],
                        										chained : tweens[key].chain != null};
                        		}
                        	}
                        };
                        
                        LR.Editor.LevelImporterEditor.prototype.setSounds = function(_objectData, _entity) {
                        	if( _objectData.sounds != null ){
                        		_entity.ed_sounds = jQuery.extend(true, [], _objectData.sounds);
                        	}
                        };
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
